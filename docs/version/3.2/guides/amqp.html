<!DOCTYPE html>
<html lang="es">







<head>
  <title>Introducción a SmallRye Reactive Messaging con AMQP 1.0 - 3.2 - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com https://ajax.googleapis.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />

  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/3.2/guides/amqp" />
  <meta property="og:title" content="Introducción a SmallRye Reactive Messaging con AMQP 1.0 - 3.2" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/amqp">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/version/3.2/guides/amqp" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/version/3.2/guides/amqp" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/version/3.2/guides/amqp" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/version/3.2/guides/amqp" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/version/3.2/guides/amqp" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  


<div class="grid-wrapper communitysite">
  <div class="grid__item width-12-12">The <a href="https://quarkus.io/version/3.2/guides/amqp">English version of quarkus.io</a> is the official project site. Translated sites are community supported on a best-effort basis.</div>
</div>


  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="#">Why<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">¿QUE ES QUARKUS?</a></li>
          <li><a href="/developer-joy" class="">SATISFACCION DEL DESARROLLADOR</a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">ESTANDARES</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">CONTENEDOR PRIMERO</a></li>
          <li><a href="/spring" class="">USING SPRING?</a></li>
          <li class="tertiarydropdown">
            <span href="#">AI<i class="fas fa-chevron-down"></i></span>
            <ul class="tertiarymenu">
              <li><a href="/ai" class="">AI OVERVIEW</a></li>
              <li><a href="/java-for-ai" class="">JAVA FOR AI</a></li>
              <li><a href="/quarkus-for-ai" class="">WHY QUARKUS FOR AI</a></li>
              <li><a href="/ai-blueprints" class="">AI BLUEPRINTS</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Learn<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">EMPEZAR</a></li>
          <li><a href="/guides" class="active">DOCUMENTACION</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">LIBROS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="#">Extensions<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
<li><a href="https://quarkus.io/extensions/" class="">BUSCAR EXTENSIONES</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USAR
EXTENSIONES</a></li>
          <li><a href="/guides/writing-extensions" class="">CREAR
EXTENSIONES</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">BUSCAR EXTENSIONES</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Community<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SOPORTE</a></li>
          <li><a href="/blog" class="">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSIONES</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTOS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">Hoja de ruta</a></li>
          <li><a href="/benefactors" class="">BENEFACTORS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">Empezar
a codificar</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/3.2/guides/amqp" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/3.2/guides/amqp">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/version/3.2/guides/amqp">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/3.2/guides/amqp">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/3.2/guides/amqp">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas
fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    






<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/3.2/guides/"> Volver a las guias</a>
    </div>
    <div class="flexlabel">
      <label>By Version</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" >Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.31.4 - Latest</option>
        
        
        
        <option value="3.27" >3.27</option>
        
        
        
        <option value="3.20" >3.20</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        <option value="3.8" >3.8</option>
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <h1 class="text-caps">Introducción a SmallRye Reactive Messaging con AMQP 1.0 </h1>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Esta guía demuestra cómo su aplicación Quarkus puede utilizar SmallRye Reactive Messaging para interactuar con AMQP 1.0.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you want to use RabbitMQ, you should use the <a href="rabbitmq">SmallRye Reactive Messaging RabbitMQ extension</a>.
Alternatively, if you want to use RabbitMQ with AMQP 1.0 you need to enable the AMQP 1.0 plugin in the RabbitMQ broker;
check the <a href="https://smallrye.io/smallrye-reactive-messaging/smallrye-reactive-messaging/3.9/amqp/amqp.html#amqp-rabbitmq">connecting to RabbitMQ</a>
documentation.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Requisitos previos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Roughly 15 minutes</p>
</li>
<li>
<p>An IDE</p>
</li>
<li>
<p>JDK 11+ installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p>Apache Maven 3.9.3</p>
</li>
<li>
<p>Docker and Docker Compose or <a href="podman">Podman</a>, and Docker Compose</p>
</li>
<li>
<p>Optionally the <a href="cli-tooling">Quarkus CLI</a> if you want to use it</p>
</li>
<li>
<p>Optionally Mandrel or GraalVM installed and <a href="building-native-image#configuring-graalvm">configured appropriately</a> if you want to build a native executable (or Docker if you use a native container build)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture"><a class="anchor" href="#architecture"></a>Arquitectura</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En esta guía, vamos a desarrollar dos aplicaciones que se comunican con un broker AMQP. Utilizaremos <a href="https://activemq.apache.org/components/artemis/">Artemis</a>, pero puede utilizar cualquier broker AMQP 1.0. La primera aplicación envía una <em>quote request</em> a una cola AMQP y consume mensajes de la cola de <em>quote</em>. La segunda aplicación recibe la <em>quote request</em> y envía una <em>quote</em> de vuelta.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/amqp-qs-architecture.png" alt="Architecture" width="80%">
</div>
</div>
<div class="paragraph">
<p>La primera aplicación, la <code>producer</code>, permitirá al usuario solicitar algunas cotizaciones a través de un punto final HTTP. Para cada solicitud de cotización, se genera un identificador aleatorio que se devuelve al usuario, para poner la solicitud de cotización en <em>pendiente</em>. Al mismo tiempo, el identificador de solicitud generado se envía a través de la cola de <code>quote-requests</code>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/amqp-qs-app-screenshot.png" alt="Producer App UI">
</div>
</div>
<div class="paragraph">
<p>La segunda aplicación, la <code>processor</code>, a su vez, leerá de la cola <code>quote-requests</code> poner un precio aleatorio a la cotización, y lo enviará a una cola llamada <code>quotes</code>.</p>
</div>
<div class="paragraph">
<p>Por último, el <code>producer</code> leerá las cotizaciones y las enviará al navegador mediante eventos enviados por el servidor. Por tanto, el usuario verá el precio de la cotización actualizado de <em>pendiente</em> al precio recibido en tiempo real.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution"><a class="anchor" href="#solution"></a>Solución</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le recomendamos que siga las instrucciones de las siguientes secciones y cree las aplicaciones paso a paso. No obstante, puede ir directamente al ejemplo completado.</p>
</div>
<div class="paragraph">
<p>Clone el repositorio Git: <code>git clone -b 3.2 <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code> o descargue un <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/3.2.zip">archivo</a>.</p>
</div>
<div class="paragraph">
<p>La solución se encuentra en <code>amqp-quickstart</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/3.2/amqp-quickstart">directorio</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-maven-project"><a class="anchor" href="#creating-the-maven-project"></a>Creación del proyecto Maven</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En primer lugar, tenemos que crear dos proyectos: el <em>productor</em> y el <em>procesador</em>.</p>
</div>
<div class="paragraph">
<p>Para crear el proyecto <em>productor</em>, en un terminal ejecute:</p>
</div>
<div class="sidebarblock primary asciidoc-tabs-sync-cli">
<div class="content">
<div class="title">CLI</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus create app org.acme:amqp-quickstart-producer \
    --extension='resteasy-reactive-jackson,smallrye-reactive-messaging-amqp' \
    --no-code</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a Gradle project, add the <code>--gradle</code> or <code>--gradle-kotlin-dsl</code> option.</p>
</div>
<div class="paragraph">
<p>For more information about how to install and use the Quarkus CLI, see the <a href="cli-tooling">Quarkus CLI</a> guide.</p>
</div>
</div>
</div>
<div class="sidebarblock secondary asciidoc-tabs-sync-maven">
<div class="content">
<div class="title">Maven</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn io.quarkus.platform:quarkus-maven-plugin:3.2.12.Final:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=amqp-quickstart-producer \
    -Dextensions='resteasy-reactive-jackson,smallrye-reactive-messaging-amqp' \
    -DnoCode</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a Gradle project, add the <code>-DbuildTool=gradle</code> or <code>-DbuildTool=gradle-kotlin-dsl</code> option.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Este comando crea la estructura del proyecto y selecciona las dos extensiones de Quarkus que vamos a utilizar:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>RESTEasy Reactive y su soporte Jackson para manejar cargas útiles JSON</p>
</li>
<li>
<p>El conector AMQP de mensajería reactiva</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Para crear el proyecto del <em>procesador</em>, desde el mismo directorio, ejecute:</p>
</div>
<div class="sidebarblock primary asciidoc-tabs-sync-cli">
<div class="content">
<div class="title">CLI</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus create app org.acme:amqp-quickstart-processor \
    --extension='smallrye-reactive-messaging-amqp' \
    --no-code</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a Gradle project, add the <code>--gradle</code> or <code>--gradle-kotlin-dsl</code> option.</p>
</div>
<div class="paragraph">
<p>For more information about how to install and use the Quarkus CLI, see the <a href="cli-tooling">Quarkus CLI</a> guide.</p>
</div>
</div>
</div>
<div class="sidebarblock secondary asciidoc-tabs-sync-maven">
<div class="content">
<div class="title">Maven</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn io.quarkus.platform:quarkus-maven-plugin:3.2.12.Final:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=amqp-quickstart-processor \
    -Dextensions='smallrye-reactive-messaging-amqp' \
    -DnoCode</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a Gradle project, add the <code>-DbuildTool=gradle</code> or <code>-DbuildTool=gradle-kotlin-dsl</code> option.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>En ese momento deberías tener la siguiente estructura:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">.
├── amqp-quickstart-processor
│  ├── README.md
│  ├── mvnw
│  ├── mvnw.cmd
│  ├── pom.xml
│  └── src
│     └── main
│        ├── docker
│        ├── java
│        └── resources
│           └── application.properties
└── amqp-quickstart-producer
   ├── README.md
   ├── mvnw
   ├── mvnw.cmd
   ├── pom.xml
   └── src
      └── main
         ├── docker
         ├── java
         └── resources
            └── application.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>Abra los dos proyectos en su IDE favorito.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-quote-object"><a class="anchor" href="#the-quote-object"></a>El objeto Cotización</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La clase <code>Quote</code> se utilizará en los proyectos <code>producer</code> y <code>processor</code>. En aras de la simplicidad duplicaremos la clase. En ambos proyectos, cree el archivo <code>src/main/java/org/acme/amqp/model/Quote.java</code>, con el siguiente contenido:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.amqp.model;

import io.quarkus.runtime.annotations.RegisterForReflection;

@RegisterForReflection
public class Quote {

    public String id;
    public int price;

    /**
    * Default constructor required for Jackson serializer
    */
    public Quote() { }

    public Quote(String id, int price) {
        this.id = id;
        this.price = price;
    }

    @Override
    public String toString() {
        return "Quote{" +
                "id='" + id + '\'' +
                ", price=" + price +
                '}';
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>La representación JSON de los objetos <code>Quote</code> se utilizará en los mensajes enviados a las colas AMQP y también en los eventos enviados por el servidor a los clientes del navegador.</p>
</div>
<div class="paragraph">
<p>Quarkus tiene capacidades incorporadas para tratar con mensajes JSON AMQP.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">@RegisterForReflection</div>
<div class="paragraph">
<p>The <code>@RegisterForReflection</code> annotation instructs Quarkus to include the class (including fields and methods) when building the native executable.
This will be useful later when we run the applications as native executables inside containers.
Without, the native compilation would remove the fields and methods during the dead-code elimination phase.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sending-quote-request"><a class="anchor" href="#sending-quote-request"></a>Envío de solicitud de presupuesto</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dentro del proyecto <code>producer</code> localice el archivo <code>src/main/java/org/acme/amqp/producer/QuotesResource.java</code> generado, y actualice el contenido para que sea:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.amqp.producer;

import java.util.UUID;

import jakarta.ws.rs.GET;
import jakarta.ws.rs.POST;
import jakarta.ws.rs.Path;
import jakarta.ws.rs.Produces;
import jakarta.ws.rs.core.MediaType;

import org.acme.amqp.model.Quote;
import org.eclipse.microprofile.reactive.messaging.Channel;
import org.eclipse.microprofile.reactive.messaging.Emitter;

import io.smallrye.mutiny.Multi;

@Path("/quotes")
public class QuotesResource {

    @Channel("quote-requests") Emitter&lt;String&gt; quoteRequestEmitter; <i class="conum" data-value="1"></i><b>(1)</b>

    /**
     * Endpoint to generate a new quote request id and send it to "quote-requests" AMQP queue using the emitter.
     */
    @POST
    @Path("/request")
    @Produces(MediaType.TEXT_PLAIN)
    public String createRequest() {
        UUID uuid = UUID.randomUUID();
        quoteRequestEmitter.send(uuid.toString()); <i class="conum" data-value="2"></i><b>(2)</b>
        return uuid.toString();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inyectar una Mensajería Reactiva <code>Emitter</code> para enviar mensajes al canal <code>quote-requests</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>En una solicitud de publicación, genera un UUID aleatorio y lo envía a la cola AMQP utilizando el emisor.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El canal <code>quote-requests</code> se va a gestionar como una cola AMQP, ya que es el único conector en el classpath. Si no se indica lo contrario, como en este ejemplo, Quarkus utiliza el nombre del canal como nombre de la cola AMQP. Así, en este ejemplo, la aplicación envía mensajes a la cola <code>quote-requests</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Si tiene varios conectores, deberá indicar qué conector desea utilizar en la configuración de la aplicación.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="processing-quote-requests"><a class="anchor" href="#processing-quote-requests"></a>Tramitación de solicitudes de quota</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ahora vamos a consumir la solicitud de presupuesto y a dar un precio. Dentro del proyecto <code>processor</code>, localice el archivo <code>src/main/java/org/acme/amqp/processor/QuoteProcessor.java</code> y añada lo siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.amqp.processor;

import java.util.Random;

import jakarta.enterprise.context.ApplicationScoped;

import org.acme.amqp.model.Quote;
import org.eclipse.microprofile.reactive.messaging.Incoming;
import org.eclipse.microprofile.reactive.messaging.Outgoing;

import io.smallrye.reactive.messaging.annotations.Blocking;

/**
 * A bean consuming data from the "request" AMQP queue and giving out a random quote.
 * The result is pushed to the "quotes" AMQP queue.
 */
@ApplicationScoped
public class QuoteProcessor {

    private Random random = new Random();

    @Incoming("requests")       <i class="conum" data-value="1"></i><b>(1)</b>
    @Outgoing("quotes")         <i class="conum" data-value="2"></i><b>(2)</b>
    @Blocking                   <i class="conum" data-value="3"></i><b>(3)</b>
    public Quote process(String quoteRequest) throws InterruptedException {
        // simulate some hard-working task
        Thread.sleep(200);
        return new Quote(quoteRequest, random.nextInt(100));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Indica que el método consume los elementos del canal <code>requests</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indica que los objetos devueltos por el método se envían al canal <code>quotes</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Indica que el procesamiento está <em>bloqueando</em> y no puede ser ejecutado en el hilo de la llamada.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El método <code>process</code> es llamado por cada mensaje AMQP de la cola <code>quote-requests</code>, y enviará un objeto <code>Quote</code> a la cola <code>quotes</code>.</p>
</div>
<div class="paragraph">
<p>Como queremos consumir mensajes de la cola <code>quotes-requests</code> en el canal <code>requests</code>, tenemos que configurar esta asociación. Abra el archivo <code>src/main/resources/application.properties</code> y añada:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">mp.messaging.incoming.requests.address=quote-requests</code></pre>
</div>
</div>
<div class="paragraph">
<p>Las claves de configuración están estructuradas de la siguiente manera:</p>
</div>
<div class="paragraph">
<p><code>mp.messaging.[outgoing|incoming].{channel-name}.property=value</code></p>
</div>
<div class="paragraph">
<p>En nuestro caso, queremos configurar el atributo <code>address</code> para indicar el nombre de la cola.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="receiving-quotes"><a class="anchor" href="#receiving-quotes"></a>Recepción de presupuestos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Volvamos a nuestro proyecto <code>producer</code>. Modifiquemos el <code>QuotesResource</code> para consumir cotizaciones, vinculémoslo a un endpoint HTTP para enviar eventos a los clientes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.smallrye.mutiny.Multi;
//...

@Channel("quotes") Multi&lt;Quote&gt; quotes;     <i class="conum" data-value="1"></i><b>(1)</b>

/**
 * Endpoint retrieving the "quotes" queue and sending the items to a server sent event.
 */
@GET
@Produces(MediaType.SERVER_SENT_EVENTS) <i class="conum" data-value="2"></i><b>(2)</b>
public Multi&lt;Quote&gt; stream() {
    return quotes; <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inyecta el canal <code>quotes</code> utilizando el calificador <code>@Channel</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indica que el contenido se envía utilizando <code>Server Sent Events</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Devuelve el flujo <em>(Reactive Stream</em>)</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-html-page"><a class="anchor" href="#the-html-page"></a>La página HTML</h2>
<div class="sectionbody">
<div class="paragraph">
<p>El toque final, la página HTML que lee los precios convertidos usando SSE.</p>
</div>
<div class="paragraph">
<p>Cree dentro del proyecto <code>producer</code> el archivo <code>src/main/resources/META-INF/resources/quotes.html</code>, con el siguiente contenido:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!DOCTYPE html&gt; &lt;html lang="en"&gt; &lt;head&gt; &lt;meta charset="UTF-8"&gt; &lt;title&gt;Quotes&lt;/title&gt;

    &lt;link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly.min.css"&gt;
    &lt;link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly-additions.min.css"&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class="container"&gt;
    &lt;div class="card"&gt;
        &lt;div class="card-body"&gt;
            &lt;h2 class="card-title"&gt;Quotes&lt;/h2&gt;
            &lt;button class="btn btn-info" id="request-quote"&gt;Request Quote&lt;/button&gt;
            &lt;div class="quotes"&gt;&lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;script src="https://code.jquery.com/jquery-3.6.0.min.js"&gt;&lt;/script&gt;
&lt;script&gt;
    $("#request-quote").click((event) =&gt; {
        fetch("/quotes/request", {method: "POST"})
        .then(res =&gt; res.text())
        .then(qid =&gt; {
            var row = $(`&lt;h4 class='col-md-12' id='${qid}'&gt;Quote # &lt;i&gt;${qid}&lt;/i&gt; | &lt;strong&gt;Pending&lt;/strong&gt;&lt;/h4&gt;`);
            $(".quotes").append(row);
        });
    });
    var source = new EventSource("/quotes");
    source.onmessage = (event) =&gt; {
      var json = JSON.parse(event.data);
      $(`#${json.id}`).html(function(index, html) {
        return html.replace("Pending", `\$\xA0${json.price}`);
      });
    };
&lt;/script&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aquí no hay nada espectacular. En cada cita recibida, actualiza la página.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="get-it-running"><a class="anchor" href="#get-it-running"></a>Ponerlo en marcha</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sólo tienes que ejecutar ambas aplicaciones utilizando:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mvn -f amqp-quickstart-producer quarkus:dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>Y, en una terminal separada:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mvn -f amqp-quickstart-processor quarkus:dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>Quarkus inicia un broker AMQP automáticamente, configura la aplicación y comparte la instancia del broker entre diferentes aplicaciones. Consulte <a href="amqp-dev-services">Servicios de desarrollo para AMQP</a> para obtener más detalles.</p>
</div>
<div class="paragraph">
<p>Abra <code><a href="http://localhost:8080/quotes.html" class="bare">http://localhost:8080/quotes.html</a></code> en su navegador y solicite algunos presupuestos haciendo clic en el botón.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-in-jvm-or-native-mode"><a class="anchor" href="#running-in-jvm-or-native-mode"></a>Ejecución en modo JVM o nativo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cuando no esté ejecutando en modo desarrollo o test, necesitará iniciar su broker AMQP. Puede seguir las instrucciones del <a href="https://activemq.apache.org/components/artemis/documentation/latest/using-server.html">sitio web de Apache ActiveMQ Artemis</a> o crear un archivo <code>docker-compose.yaml</code> con el siguiente contenido:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">version: '2'

services:

  artemis:
    image: quay.io/artemiscloud/activemq-artemis-broker:0.1.2
    ports:
      - "8161:8161"
      - "61616:61616"
      - "5672:5672"
    environment:
      AMQ_USER: quarkus
      AMQ_PASSWORD: quarkus
    networks:
      - amqp-quickstart-network

  producer:
    image: quarkus-quickstarts/amqp-quickstart-producer:1.0-${QUARKUS_MODE:-jvm}
    build:
      context: amqp-quickstart-producer
      dockerfile: src/main/docker/Dockerfile.${QUARKUS_MODE:-jvm}
    environment:
      AMQP_HOST: artemis
      AMQP_PORT: 5672
    ports:
      - "8080:8080"
    networks:
      - amqp-quickstart-network

  processor:
    image: quarkus-quickstarts/amqp-quickstart-processor:1.0-${QUARKUS_MODE:-jvm}
    build:
      context: amqp-quickstart-processor
      dockerfile: src/main/docker/Dockerfile.${QUARKUS_MODE:-jvm}
    environment:
      AMQP_HOST: artemis
      AMQP_PORT: 5672
    networks:
      - amqp-quickstart-network

networks:
  amqp-quickstart-network:
    name: amqp-quickstart</code></pre>
</div>
</div>
<div class="paragraph">
<p>Observe cómo se configura la ubicación del agente AMQP. Las propiedades <code>amqp.host</code> y <code>amqp.port</code> ( <code>AMQP_HOST</code> y <code>AMQP_PORT</code> variables de entorno) configuran la ubicación.</p>
</div>
<div class="paragraph">
<p>En primer lugar, asegúrese de que ha detenido las aplicaciones, y construya ambas aplicaciones en modo JVM con:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mvn -f amqp-quickstart-producer clean package
&gt; mvn -f amqp-quickstart-processor clean package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez empaquetado, ejecute <code>docker compose up --build</code> . La interfaz de usuario se expone en <a href="http://localhost:8080/quotes.html" class="bare">http://localhost:8080/quotes.html</a> .</p>
</div>
<div class="paragraph">
<p>Para ejecutar tus aplicaciones como nativas, primero tenemos que construir los ejecutables nativos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mvn -f amqp-quickstart-producer package -Dnative  -Dquarkus.native.container-build=true
&gt; mvn -f amqp-quickstart-processor package -Dnative -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>El <code>-Dquarkus.native.container-build=true</code> instruye a Quarkus para construir ejecutables nativos de Linux 64bits, que pueden ejecutarse dentro de contenedores. A continuación, ejecute el sistema utilizando:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; export QUARKUS_MODE=native
&gt; docker compose up --build</code></pre>
</div>
</div>
<div class="paragraph">
<p>Como antes, la interfaz de usuario está expuesta en <a href="http://localhost:8080/quotes.html" class="bare">http://localhost:8080/quotes.html</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="going-further"><a class="anchor" href="#going-further"></a>Ir más allá</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Esta guía ha mostrado cómo se puede interactuar con AMQP 1.0 utilizando Quarkus. Utiliza <a href="https://smallrye.io/smallrye-reactive-messaging">SmallRye Reactive Messaging</a> para construir aplicaciones de flujo de datos.</p>
</div>
<div class="paragraph">
<p>Si ha realizado el quickstart de Kafka, se habrá dado cuenta de que se trata del mismo código. La única diferencia es la configuración del conector y el mapeo JSON.</p>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#prerequisites">Requisitos previos</a></li>
<li><a href="#architecture">Arquitectura</a></li>
<li><a href="#solution">Solución</a></li>
<li><a href="#creating-the-maven-project">Creación del proyecto Maven</a></li>
<li><a href="#the-quote-object">El objeto Cotización</a></li>
<li><a href="#sending-quote-request">Envío de solicitud de presupuesto</a></li>
<li><a href="#processing-quote-requests">Tramitación de solicitudes de quota</a></li>
<li><a href="#receiving-quotes">Recepción de presupuestos</a></li>
<li><a href="#the-html-page">La página HTML</a></li>
<li><a href="#get-it-running">Ponerlo en marcha</a></li>
<li><a href="#running-in-jvm-or-native-mode">Ejecución en modo JVM o nativo</a></li>
<li><a href="#going-further">Ir más allá</a></li>
</ul></div>
    </div>
  </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license. <i class='fab fa-creative-commons'></i><i class='fab fa-creative-commons-by'></i> <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC by 3.0</a><br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Boletín de noticias</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Hoja de ruta</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Uso</a></li>
          
          
          
            <li><a href="https://github.com/commonhaus/artwork/tree/main/projects/quarkus" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
          
            <li><a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy Policy</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.threads.com/@quarkusio" target="_blank">Threads</a></li>
          
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guías</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Primeros pasos</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
          
            <li><a href="https://stats.uptimerobot.com/ze1PfweT2p" target="_blank">Quarkus Service Status</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content cf-footer">
  <div class="flexcontainer">
    <div class="cf-logo">
      <a class="cf-logo" href="https://www.commonhaus.org/" target="_blank"><img src="https://raw.githubusercontent.com/commonhaus/artwork/main/foundation/brand/svg/CF_logo_horizontal_single_reverse.svg"/></a>
    </div>
    <div class="license">
      Copyright © Quarkus. All rights reserved. For details on our trademarks, please visit our <a href="https://www.commonhaus.org/policies/trademark-policy/">Trademark Policy</a> and <a href="https://www.commonhaus.org/trademarks/">Trademark List</a>. Trademarks of third parties are owned by their respective holders and their mention here does not suggest any endorsement or association.
    </div>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
  <script src="/assets/javascript/randomize.js" type="text/javascript"></script>
  <script src="/assets/javascript/time.js" type="text/javascript"></script>
</body>

</html>
