<!DOCTYPE html>
<html lang="es">







<head>
  <title>AWS Lambda con Quarkus REST, Undertow o Rutas Reactivas - 3.20 - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
  connect-src 'self' https://dpm.demdex.net https://adobedc.demdex.net https://analytics.ossupstream.org/ https://search.quarkus.io https://smetrics.redhat.com https://ajax.googleapis.com; 
  script-src 'self' 'unsafe-inline' 'unsafe-eval'
      
      https://assets.adobedtm.com
      js.bizographics.com
      https://www.redhat.com
      https://static.redhat.com
      https://app.requestly.io/
      jsonip.com
      https://ajax.googleapis.com
      https://use.fontawesome.com
      http://www.youtube.com
      http://www.googleadservices.com
      https://googleads.g.doubleclick.net
      https://giscus.app
      https://analytics.ossupstream.org/
      https://app.mailjet.com;

  style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; 
  img-src 'self' * data:; 
  media-src 'self'; 
  frame-src https://redhat.demdex.net https://www.youtube.com https://player.restream.io https://app.mailjet.com http://xy0p2.mjt.lu https://mj.quarkus.io https://giscus.app; 
  base-uri 'none'; 
  object-src 'none'; 
  form-action 'none'; 
  font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />

  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/3.20/guides/aws-lambda-http" />
  <meta property="og:title" content="AWS Lambda con Quarkus REST, Undertow o Rutas Reactivas - 3.20" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/aws-lambda-http">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/version/3.20/guides/aws-lambda-http" />
  
  <link rel="alternate" hreflang="pt-br" href="https://pt.quarkus.io/version/3.20/guides/aws-lambda-http" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/version/3.20/guides/aws-lambda-http" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/version/3.20/guides/aws-lambda-http" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/version/3.20/guides/aws-lambda-http" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />  
  <script src="/assets/javascript/tracking.js"></script>
  
  <script src="/assets/javascript/colormode.js" type="text/javascript"></script>

</head>

<body class="guides">

  


<div class="grid-wrapper communitysite">
  <div class="grid__item width-12-12">The <a href="https://quarkus.io/version/3.20/guides/aws-lambda-http">English version of quarkus.io</a> is the official project site. Translated sites are community supported on a best-effort basis.</div>
</div>


  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
        <div class="logo-wrapper">
           <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
        </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="#">Why<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">¿QUE ES QUARKUS?</a></li>
          <li><a href="/developer-joy" class="">SATISFACCION DEL DESARROLLADOR</a></li>
          <li><a href="/performance" class="">PERFORMANCE</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">ESTANDARES</a></li>
          <li><a href="/versatility" class="">VERSATILITY</a></li>
          <li><a href="/container-first" class="">CONTENEDOR PRIMERO</a></li>
          <li><a href="/spring" class="">USING SPRING?</a></li>
          <li class="tertiarydropdown">
            <span href="#">AI<i class="fas fa-chevron-down"></i></span>
            <ul class="tertiarymenu">
              <li><a href="/ai" class="">AI OVERVIEW</a></li>
              <li><a href="/java-for-ai" class="">JAVA FOR AI</a></li>
              <li><a href="/quarkus-for-ai" class="">WHY QUARKUS FOR AI</a></li>
              <li><a href="/ai-blueprints" class="">AI BLUEPRINTS</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Learn<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">EMPEZAR</a></li>
          <li><a href="/guides" class="active">DOCUMENTACION</a></li>
          <li><a href="/userstories/" class="">USER STORIES</a></li>  
          <li><a href="/qtips" class="">"Q" TIP VIDEOS</a></li>          
          <li><a href="/books" class="">LIBROS</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="#">Extensions<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          
          <!-- Note that quarkus.io is hardcoded here, because it is the only url which supports extensions -->
<li><a href="https://quarkus.io/extensions/" class="">BUSCAR EXTENSIONES</a></li>
          <li><a href="/faq/#what-is-a-quarkus-extension" class="">USAR
EXTENSIONES</a></li>
          <li><a href="/guides/writing-extensions" class="">CREAR
EXTENSIONES</a></li>
          <li><a href="https://hub.quarkiverse.io" class="">BUSCAR EXTENSIONES</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="#">Community<i class="fas fa-chevron-down firsti"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">SOPORTE</a></li>
          <li><a href="/blog" class="">BLOG</a></li>
          <li><a href="/discussion" class="">DISCUSIONES</a></li>
          <li><a href="/working-groups" class="">WORKING GROUPS</a></li>
          <li><a href="/insights" class="">PODCAST</a></li>
          <li><a href="/events" class="">EVENTOS</a></li>
          <li><a href="/newsletter" class="">NEWSLETTER</a></li>
          <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" class="">Hoja de ruta</a></li>
          <li><a href="/benefactors" class="">BENEFACTORS</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary white">Empezar
a codificar</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/3.20/guides/aws-lambda-http" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://pt.quarkus.io/version/3.20/guides/aws-lambda-http">PORTUGUÊS (BR)</a></li>
          <li><a href="https://es.quarkus.io/version/3.20/guides/aws-lambda-http">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/3.20/guides/aws-lambda-http">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/3.20/guides/aws-lambda-http">日本語</a></li>
          </ul>
      </li>
      <li>
        <span href="#" class="modeswitcher" id='theme-toggle'><i class="fas
fa-sun"></i><i class="fas fa-moon"></i><i class="fas fa-cog"></i></span>
      </li>
    </ul>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    






<section class="full-width-version-bg flexfilterbar guides">
  <div class="guideflexcontainer">
    <div class="docslink">
      <a class="returnlink" href="/version/3.20/guides/"> Volver a las guias</a>
    </div>
    <div class="flexlabel">
      <label>By Version</label>
    </div>
    <div class="guidepulldown version">
    <select id="guide-version-dropdown">
      
        
        
        <option value="main" >Main - SNAPSHOT</option>
        
        
        
        <option value="latest" >3.31.4 - Latest</option>
        
        
        
        <option value="3.27" >3.27</option>
        
        
        
        <option value="3.20" selected>3.20</option>
        
        
        
        <option value="3.15" >3.15</option>
        
        
        
        <option value="3.8" >3.8</option>
        </select>
    </div>
  </div>
</section>

<div class="guide">
  <div class="grid-wrapper">
    <div class="grid__item width-8-12 width-12-12-m">
      
      <h1 class="text-caps">AWS Lambda con Quarkus REST, Undertow o Rutas Reactivas </h1>
      <a class="status-label status-preview" title="This extension's backward compatibility and presence in the ecosystem is not guaranteed" href="#extension-status-note">preview</a>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Con Quarkus puede implementar sus marcos Java HTTP favoritos como AWS Lambda utilizando <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api.html">HTTP API de AWS Gateway</a> o la <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-rest-api.html">API REST de AWS Gateway</a>. Esto significa que puede implementar sus microservicios escritos con Quarkus REST (nuestra implementación de Jakarta REST), Undertow (servlet), Reactive Routes, <a href="funqy-http">Funqy HTTP</a> o cualquier otro marco HTTP de Quarkus como una AWS Lambda.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Sólo debe utilizar un único marco HTTP junto con la extensión AWS Lambda para evitar conflictos y errores inesperados.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Puede desplegar su Lambda como un jar de Java puro, o puede compilar su proyecto en una imagen nativa y desplegarla para reducir la huella de memoria y el tiempo de inicio. Nuestra integración también genera archivos de despliegue SAM que pueden ser consumidos por el marco de trabajo <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html">SAM de Amazon</a>.</p>
</div>
<div class="paragraph">
<p>Quarkus tiene una extensión diferente para cada Gateway API. La API HTTP Gateway se implementa dentro de la extensión <code>quarkus-amazon-lambda-http</code>. La API REST Gateway se implementa dentro de la extensión <code>quarkus-amazon-lambda-rest</code>. Si está confundido sobre qué producto Gateway utilizar, Amazon tiene una <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-vs-rest.html">gran guía</a> para ayudarle a tomar esta decisión.</p>
</div>
<div class="paragraph">
<p>Como la mayoría de las extensiones de Quarkus, las extensiones HTTP/REST de Quarkus AWS Lambda admiten Live Coding.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This technology is considered preview.</p>
</div>
<div class="paragraph">
<p>In <em>preview</em>, backward compatibility and presence in the ecosystem is not guaranteed.
Specific improvements might require changing configuration or APIs, and plans to become <em>stable</em> are under way.
Feedback is welcome on our <a href="https://groups.google.com/d/forum/quarkus-dev">mailing list</a> or as issues in our <a href="https://github.com/quarkusio/quarkus/issues">GitHub issue tracker</a>.</p>
</div>
<div class="paragraph">
<p>For a full list of possible statuses, check our <a href="https://quarkus.io/faq/#what-are-the-extension-statuses">FAQ entry</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Requisitos previos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Roughly 30 minutes</p>
</li>
<li>
<p>An IDE</p>
</li>
<li>
<p>JDK 17+ installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p>Apache Maven 3.9.9</p>
</li>
<li>
<p>Optionally the <a href="cli-tooling">Quarkus CLI</a> if you want to use it</p>
</li>
<li>
<p>Optionally Mandrel or GraalVM installed and <a href="building-native-image#configuring-graalvm">configured appropriately</a> if you want to build a native executable (or Docker if you use a native container build)</p>
</li>
<li>
<p><a href="https://aws.amazon.com">Una cuenta de Amazon AWS</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html">AWS SAM CLI</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a>Primeros pasos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Esta guía le lleva a través de la generación de un proyecto Java de ejemplo mediante un arquetipo de Maven. Más adelante, recorre la estructura del proyecto para que pueda adaptar cualquier proyecto existente que tenga para utilizar AWS Lambda.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-aws-bits"><a class="anchor" href="#installing-aws-bits"></a>Instalación de los bits de AWS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instalar todos los bits de AWS es probablemente lo más difícil de esta guía. Asegúrese de seguir todos los pasos para instalar AWS SAM CLI.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-maven-deployment-project"><a class="anchor" href="#creating-the-maven-deployment-project"></a>Creación del proyecto de Maven</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Crea el proyecto Quarkus AWS Lambda Maven utilizando nuestro Arquetipo Maven.</p>
</div>
<div class="paragraph">
<p>Si desea utilizar la API HTTP de AWS Gateway, genere su proyecto con este script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn archetype:generate \
       -DarchetypeGroupId=io.quarkus \
       -DarchetypeArtifactId=quarkus-amazon-lambda-http-archetype \
       -DarchetypeVersion=3.20.5</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si desea utilizar la API REST de AWS Gateway, genere su proyecto con este script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn archetype:generate \
       -DarchetypeGroupId=io.quarkus \
       -DarchetypeArtifactId=quarkus-amazon-lambda-rest-archetype \
       -DarchetypeVersion=3.20.5</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-and-deploy"><a class="anchor" href="#build-and-deploy"></a>Construir y desplegar</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Construye el proyecto:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw install</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esto compilará el código y ejecutará las pruebas unitarias incluidas en el proyecto generado. Las pruebas unitarias son las mismas que en cualquier otro proyecto Java y no requieren ser ejecutadas en Amazon. El modo dev de Quarkus también está disponible con esta extensión.</p>
</div>
<div class="paragraph">
<p>Si desea construir un ejecutable nativo, asegúrese de que tiene GraalVM instalado correctamente y sólo tiene que añadir una propiedad <code>native</code> a la construcción</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw install -Dnative</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Si está construyendo en un sistema que no sea Linux, necesitará también pasar una propiedad indicando a quarkus que utilice una construcción Docker ya que Amazon Lambda requiere binarios Linux. Puede hacerlo pasando <code>-Dquarkus.native.container-build=true</code> a su comando de compilación. Esto requiere que usted tenga Docker instalado localmente, sin embargo.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>According to the <a href="https://docs.aws.amazon.com/linux/al2023/ug/system-requirements.html#system-requirements-cpu-x86-64">AWS documentation</a>, AL2023
x86-64 binaries are built for the x86-64-<strong>v2</strong> revision of the x86-64 architecture.
In Quarkus, the default value of <a href="building-native-image#quarkus-core_quarkus-native-march">quarkus.native.march</a> is x86-64-<strong>v3</strong>.
This could cause
<a href="https://repost.aws/questions/QUBVnl6hn-Toe1LPr1qjOXzg/lambda-failed-with-java-compiled-into-machine-code">issues</a> if AWS Lambda provisions older
hardware.
To maximize Lambda compatibility, you can set <code>quarkus.native.march</code> to <code>x86-64-v2</code>.
See the <a href="native-reference#work-around-missing-cpu-features">Native Reference</a> guide for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native --no-tests -Dquarkus.native.container-build=true
# The --no-tests flag is required only on Windows and macOS.</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw install -Dnative -DskipTests -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="extra-build-generated-files"><a class="anchor" href="#extra-build-generated-files"></a>Archivos extra generados por la compilación</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Después de ejecutar la construcción, hay algunos archivos adicionales generados por la extensión lambda de Quarkus que estás utilizando. Estos archivos están en el directorio de construcción: <code>target/</code> para Maven, <code>build/</code> para Gradle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>function.zip</code> - archivo de despliegue de lambda</p>
</li>
<li>
<p><code>sam.jvm.yaml</code> - sam cli script de despliegue</p>
</li>
<li>
<p><code>sam.native.yaml</code> - sam cli script de despliegue para nativos</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="live-coding-and-simulating-aws-lambda-environment-locally"><a class="anchor" href="#live-coding-and-simulating-aws-lambda-environment-locally"></a>Codificación en vivo y simulación local del entorno de AWS Lambda</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En los modos desarrollo y test, Quarkus iniciará un servidor de eventos AWS Lambda simulado que convertirá las solicitudes HTTP en los tipos de eventos API Gateway correspondientes y los enviará al entorno lambda HTTP subyacente de Quarkus para su procesamiento. Esto simula el entorno AWS Lambda tanto como sea posible localmente sin requerir herramientas como Docker y SAM CLI.</p>
</div>
<div class="paragraph">
<p>Cuando utilice el modo desarrollo de Quarkus sólo tiene que invocar peticiones HTTP en <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code> como haría normalmente al probar sus puntos finales REST. Esta solicitud llegará al Servidor de Eventos Mock y se convertirá en el mensaje json API Gateway que es consumido por el bucle de sondeo Lambda de Quarkus.</p>
</div>
<div class="paragraph">
<p>Para las pruebas, Quarkus pone en marcha un servidor Mock Event independiente en el puerto 8081. El puerto por defecto para Rest Assured es configurado automáticamente a 8081 por Quarkus, por lo que no tiene que preocuparse de configurarlo.</p>
</div>
<div class="paragraph">
<p>Si desea simular eventos API Gateway más complejos en sus pruebas, entonces haga manualmente un POST HTTP a <code><a href="http://localhost:8080/" class="bare">http://localhost:8080/</a><em>lambda</em></code> (puerto 8081 en modo de prueba) con los eventos json de API Gateway sin procesar. Estos eventos se colocarán directamente en el bucle de sondeo Lambda de Quarkus para su procesamiento. He aquí un ejemplo de ello:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import static io.restassured.RestAssured.given;
import static org.hamcrest.CoreMatchers.equalTo;

import com.amazonaws.services.lambda.runtime.events.APIGatewayV2HTTPEvent;

import io.quarkus.test.junit.QuarkusTest;

@QuarkusTest
public class AmazonLambdaSimpleTestCase {
    @Test
    public void testJaxrsCognitoJWTSecurityContext() throws Exception {
        APIGatewayV2HTTPEvent request = request("/security/username");
        request.getRequestContext().setAuthorizer(new APIGatewayV2HTTPEvent.RequestContext.Authorizer());
        request.getRequestContext().getAuthorizer().setJwt(new APIGatewayV2HTTPEvent.RequestContext.Authorizer.JWT());
        request.getRequestContext().getAuthorizer().getJwt().setClaims(new HashMap&lt;&gt;());
        request.getRequestContext().getAuthorizer().getJwt().getClaims().put("cognito:username", "Bill");

        given()
                .contentType("application/json")
                .accept("application/json")
                .body(request)
                .when()
                .post("/_lambda_")
                .then()
                .statusCode(200)
                .body("body", equalTo("Bill"));
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>El ejemplo anterior simula el envío de una entidad de seguridad Cognito con una solicitud HTTP a su Lambda HTTP.</p>
</div>
<div class="paragraph">
<p>Si desea codificar a mano eventos sin procesar para la API HTTP de AWS, la biblioteca AWS Lambda tiene el tipo de evento de solicitud que es <code>com.amazonaws.services.lambda.runtime.events.APIGatewayV2HTTPEvent</code> y el tipo de evento de respuesta de <code>com.amazonaws.services.lambda.runtime.events.APIGatewayV2HTTPResponse</code>. Esto corresponde a la extensión <code>quarkus-amazon-lambda-http</code> y a la API HTTP de AWS.</p>
</div>
<div class="paragraph">
<p>Si desea codificar a mano eventos sin procesar para la API REST de AWS, Quarkus tiene su propia implementación: <code>io.quarkus.amazon.lambda.http.model.AwsProxyRequest</code> y <code>io.quarkus.amazon.lambda.http.model.AwsProxyResponse</code>. Esto corresponde a la extensión <code>quarkus-amazon-lambda-rest</code> y a la API REST de AWS.</p>
</div>
<div class="paragraph">
<p>El servidor de eventos simulados también se inicia para las pruebas de <code>@NativeImageTest</code> y <code>@QuarkusIntegrationTest</code>, por lo que también funcionará con binarios nativos. Todo esto proporciona una funcionalidad similar a las pruebas locales de SAM CLI, sin la sobrecarga de Docker.</p>
</div>
<div class="paragraph">
<p>Por último, si el puerto 8080 o el puerto 8081 no están disponibles en su ordenador, puede modificar los puertos de los modos dev y test con application.properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">quarkus.lambda.mock-event-server.dev-port=8082
quarkus.lambda.mock-event-server.test-port=8083</code></pre>
</div>
</div>
<div class="paragraph">
<p>Un valor de puerto de cero resultará en un puerto asignado aleatoriamente.</p>
</div>
<div class="paragraph">
<p>Para desactivar el servidor de eventos simulado:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">quarkus.lambda.mock-event-server.enabled=false</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="simulate-aws-lambda-deployment-with-sam-cli"><a class="anchor" href="#simulate-aws-lambda-deployment-with-sam-cli"></a>Simular la implementación de AWS Lambda con SAM CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La CLI SAM de AWS le permite ejecutar sus Lambda localmente en su portátil en un entorno Lambda simulado. Para ello es necesario tener instalado Docker. Después de haber construido su proyecto Maven, ejecute este comando:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local start-api --template target/sam.jvm.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esto iniciará un contenedor Docker que imita el entorno de despliegue de Amazon Lambda. Una vez iniciado el entorno, puede invocar la lambda de ejemplo en su navegador dirigiéndose a:</p>
</div>
<div class="paragraph">
<p><a href="http://127.0.0.1:3000/hello" class="bare">http://127.0.0.1:3000/hello</a></p>
</div>
<div class="paragraph">
<p>En la consola verá los mensajes de inicio de la lambda. Este despliegue en particular inicia una JVM y carga su lambda como Java puro.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploy-to-aws"><a class="anchor" href="#deploy-to-aws"></a>Implementación en AWS</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam deploy -t target/sam.jvm.yaml -g</code></pre>
</div>
</div>
<div class="paragraph">
<p>Responda a todas las preguntas y su lambda se desplegará y se configurarán los ganchos necesarios a la API Gateway. Si todo se despliega correctamente, la URL raíz de su microservicio se mostrará en la consola. Algo como esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Key                 LambdaHttpApi
Description         URL for application
Value               https://234asdf234as.execute-api.us-east-1.amazonaws.com/</pre>
</div>
</div>
<div class="paragraph">
<p>El atributo <code>Value</code> es la URL raíz de tu lambda. Cópialo en tu navegador y añade <code>hello</code> al final.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Las respuestas para los tipos binarios se codificarán automáticamente con base64. Esto es diferente al comportamiento usando <code>quarkus:dev</code> que devolverá los bytes sin procesar. La API de Amazon tiene restricciones adicionales que requieren la codificación base64. En general, el código del cliente manejará automáticamente esta codificación, pero en ciertas situaciones personalizadas, debes tener en cuenta que puedes necesitar manejar manualmente esa codificación.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploying-a-native-executable"><a class="anchor" href="#deploying-a-native-executable"></a>Despliegue de un ejecutable nativo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para desplegar un ejecutable nativo, debes construirlo con GraalVM.</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native --no-tests -Dquarkus.native.container-build=true
# The --no-tests flag is required only on Windows and macOS.</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw install -Dnative -DskipTests -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuación, puede probar el ejecutable localmente con sam local</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local start-api --template target/sam.native.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para implementar en AWS Lambda:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam deploy -t target/sam.native.yaml -g</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examine-the-pom"><a class="anchor" href="#examine-the-pom"></a>Examinar el POM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>No hay nada especial en el POM aparte de la inclusión de la extensión <code>quarkus-amazon-lambda-http</code> (si está implementando una API HTTP de AWS Gateway) o la extensión <code>quarkus-amazon-lambda-rest</code> (si está implementando una API REST de AWS Gateway). Estas extensiones generan automáticamente todo lo que pueda necesitar para su implementación de Lambda.</p>
</div>
<div class="paragraph">
<p>Además, al menos en el arquetipo de Maven generado <code>pom.xml</code>, las dependencias <code>quarkus-rest</code>,  <code>quarkus-reactive-routes</code>, y <code>quarkus-undertow</code> son todas opcionales. Elija qué framework(s) HTTP desea utilizar (Jakarta REST, Reactive Routes, y/o Servlet) y elimine las demás dependencias para reducir su despliegue.</p>
</div>
<div class="sect2">
<h3 id="examine-sam-yaml"><a class="anchor" href="#examine-sam-yaml"></a>Examinar sam.yaml</h3>
<div class="paragraph">
<p>La sintaxis de <code>sam.yaml</code> está fuera del alcance de este documento. Hay un par de cosas que deben resaltarse en caso de que vaya a elaborar sus propios archivos de despliegue personalizados de <code>sam.yaml</code>.</p>
</div>
<div class="paragraph">
<p>Lo primero que hay que tener en cuenta es que para los despliegues lambda puramente Java se requiere una clase manejadora específica. No cambie el nombre del manejador Lambda.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">     Properties:
        Handler: io.quarkus.amazon.lambda.runtime.QuarkusStreamHandler::handleRequest
        Runtime: java17</code></pre>
</div>
</div>
<div class="paragraph">
<p>Este manejador es un puente entre el tiempo de ejecución de lambda y el framework HTTP de Quarkus que estés utilizando (Jakarta REST, Servlet, etc.)</p>
</div>
<div class="paragraph">
<p>Si desea ir nativo, hay una variable de entorno que se debe establecer para las implementaciones nativas de GraalVM. Si mira en <code>sam.native.yaml</code> verá esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">        Environment:
          Variables:
            DISABLE_SIGNAL_HANDLERS: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta variable de entorno resuelve algunas incompatibilidades entre Quarkus y el entorno de ejecución personalizado de AWS Lambda.</p>
</div>
<div class="paragraph">
<p>Por último, hay algo específico para las implementaciones de la API REST de AWS Gateway. Esa API asume que los cuerpos de respuesta HTTP son texto, a menos que se le indique explícitamente qué tipos de medios son binarios mediante la configuración. Para facilitar las cosas, la extensión Quarkus fuerza una codificación binaria (base 64) de todos los mensajes de respuesta HTTP y el archivo <code>sam.yaml</code> debe configurar la API Gateway para que asuma que todos los tipos de medios son binarios:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">  Globals:
    Api:
      EndpointConfiguration: REGIONAL
      BinaryMediaTypes:
        - "*/*"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="injectable-aws-context-variables"><a class="anchor" href="#injectable-aws-context-variables"></a>Variables de contexto de AWS inyectables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Si utiliza Quarkus REST y Jakarta REST, puede inyectar diversas variables de contexto de AWS en sus clases de recursos Jakarta REST utilizando la anotación Jakarta REST <code>@Context</code> o en cualquier otro lugar con la anotación CDI <code>@Inject</code>.</p>
</div>
<div class="paragraph">
<p>Para la API HTTP de AWS puede inyectar las variables de AWS <code>com.amazonaws.services.lambda.runtime.Context</code> y <code>com.amazonaws.services.lambda.runtime.events.APIGatewayV2HTTPEvent</code>. He aquí un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.ws.rs.core.Context;
import com.amazonaws.services.lambda.runtime.events.APIGatewayV2HTTPEvent;


@Path("/myresource")
public class MyResource {
    @GET
    public String ctx(@Context com.amazonaws.services.lambda.runtime.Context ctx) { }

    @GET
    public String event(@Context APIGatewayV2HTTPEvent event) { }

    @GET
    public String requestContext(@Context APIGatewayV2HTTPEvent.RequestContext req) { }


}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para la API REST de AWS puede inyectar las variables de AWS <code>com.amazonaws.services.lambda.runtime.Context</code> y <code>io.quarkus.amazon.lambda.http.model.AwsProxyRequestContext</code>. He aquí un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.ws.rs.core.Context;
import io.quarkus.amazon.lambda.http.model.AwsProxyRequestContext;
import io.quarkus.amazon.lambda.http.model.AwsProxyRequest;


@Path("/myresource")
public class MyResource {
    @GET
    public String ctx(@Context com.amazonaws.services.lambda.runtime.Context ctx) { }

    @GET
    public String reqContext(@Context AwsProxyRequestContext req) { }

    @GET
    public String req(@Context AwsProxyRequest req) { }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tracing-with-aws-xray-and-graalvm"><a class="anchor" href="#tracing-with-aws-xray-and-graalvm"></a>Rastreo con AWS XRay y GraalVM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Si estás construyendo imágenes nativas, y quieres usar <a href="https://aws.amazon.com/xray">AWS X-Ray Tracing</a> con tu lambda necesitarás incluir <code>quarkus-amazon-lambda-xray</code> como una dependencia en tu pom. La biblioteca de AWS X-Ray no es totalmente compatible con GraalVM, por lo que hemos tenido que hacer un trabajo de integración para que funcione.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-integration"><a class="anchor" href="#security-integration"></a>Integración de la seguridad</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cuando se invoca una solicitud HTTP en API Gateway, el gateway convierte esa solicitud HTTP en un documento de evento JSON que se reenvía a un Quarkus Lambda. La Lambda de Quarkus analiza este json y lo convierte en una representación interna de una solicitud HTTP que puede ser consumida por cualquier marco HTTP que Quarkus admita (JAX-RS, servlet, Rutas Reactivas).</p>
</div>
<div class="paragraph">
<p>API Gateway admite muchas formas diferentes de invocar de forma segura en sus puntos finales HTTP que están respaldados por Lambda y Quarkus. Si lo habilitas, Quarkus analizará automáticamente las partes relevantes del <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-develop-integrations-lambda.html">documento json</a> del evento y buscará metadatos basados en la seguridad y registrará un <code>java.security.Principal</code> internamente que puede ser buscado en JAX-RS inyectando un <code>javax.ws.rs.core.SecurityContext</code>, a través de <code>HttpServletRequest.getUserPrincipal()</code> en servlet, y <code>RouteContext.user()</code> en Reactive Routes. Si quieres más información de seguridad, el objeto <code>Principal</code> puede ser typecast a una clase que te dará más información.</p>
</div>
<div class="paragraph">
<p>Para activar esta función de seguridad, añada esto a su archivo <code>application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>quarkus.lambda-http.enable-security=true</pre>
</div>
</div>
<div class="paragraph">
<p>Aquí está cómo está mapeado:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. HTTP <code>quarkus-amazon-lambda-http</code></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo de autorización</th>
<th class="tableblock halign-left valign-top">Clase principal</th>
<th class="tableblock halign-left valign-top">Ruta Json del nombre principal</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cognito JWT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.quarkus.amazon.lambda.http.CognitoPrincipal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestContext.authorizer.jwt.claims.cognito:username</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IAM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.quarkus.amazon.lambda.http.IAMPrincipal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestContext.authorizer.iam.userId</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lambda personalizado</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.quarkus.amazon.lambda.http.CustomPrincipal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestContext.authorizer.lambda.principalId</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. REST <code>quarkus-amazon-lambda-rest</code></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo de autorización</th>
<th class="tableblock halign-left valign-top">Clase principal</th>
<th class="tableblock halign-left valign-top">Ruta Json del nombre principal</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cognito</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.quarkus.amazon.lambda.http.CognitoPrincipal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestContext.authorizer.claims.cognito:username</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IAM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.quarkus.amazon.lambda.http.IAMPrincipal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestContext.identity.user</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lambda personalizado</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.quarkus.amazon.lambda.http.CustomPrincipal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestContext.authorizer.principalId</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Si el reclamo <code>cognito:groups</code> está presente, entonces Quarkus extraerá y mapeará esos grupos a los roles de Quarkus que luego pueden ser usados en la autorización con anotaciones como <code>@RolesAllowed</code>. Si no desea asignar <code>cognito:groups</code> a los roles de Quarkus, entonces debe desactivarlo explícitamente en la configuración:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>quarkus.lambda-http.map-cognito-to-roles=false</pre>
</div>
</div>
<div class="paragraph">
<p>También puede especificar una demanda de Cognito diferente de la que extraer los roles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>quarkus.lambda-http.cognito-role-claim=cognito:roles</pre>
</div>
</div>
<div class="paragraph">
<p>Por defecto, espera los roles en una lista delimitada por espacios y encerrada entre paréntesis, es decir, <code>[ user admin ]</code>. También puede especificar la expresión regular que se utilizará para encontrar roles individuales en la cadena de reclamación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>quarkus.lambda-http.cognito-claim-matcher=[^\[\] \t]+</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="custom-security-integration"><a class="anchor" href="#custom-security-integration"></a>Integración de seguridad personalizada</h2>
<div class="sectionbody">
<div class="paragraph">
<p>El soporte por defecto para la seguridad de AWS sólo asigna el nombre principal a las API de seguridad de Quarkus y no hace nada para asignar reclamaciones, funciones o permisos. Usted puede controlar completamente cómo se asignan los metadatos de seguridad en el evento HTTP lambda a las API de seguridad de Quarkus utilizando implementaciones de la interfaz <code>io.quarkus.amazon.lambda.http.LambdaIdentityProvider</code>. Al implementar esta interfaz, puede hacer cosas como definir asignaciones de roles para su director o publicar atributos adicionales proporcionados por IAM o Cognito o su integración de seguridad Lambda personalizada.</p>
</div>
<div class="listingblock">
<div class="title">HTTP <code>quarkus-amazon-lambda-http</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkus.amazon.lambda.http;

/**
 * Helper interface that removes some boilerplate for creating
 * an IdentityProvider that processes APIGatewayV2HTTPEvent
 */
public interface LambdaIdentityProvider extends IdentityProvider&lt;LambdaAuthenticationRequest&gt; {
    @Override
    default public Class&lt;LambdaAuthenticationRequest&gt; getRequestType() {
        return LambdaAuthenticationRequest.class;
    }

    @Override
    default Uni&lt;SecurityIdentity&gt; authenticate(LambdaAuthenticationRequest request, AuthenticationRequestContext context) {
        APIGatewayV2HTTPEvent event = request.getEvent();
        SecurityIdentity identity = authenticate(event);
        if (identity == null) {
            return Uni.createFrom().optional(Optional.empty());
        }
        return Uni.createFrom().item(identity);
    }

    /**
     * You must override this method unless you directly override
     * IdentityProvider.authenticate
     *
     * @param event
     * @return
     */
    default SecurityIdentity authenticate(APIGatewayV2HTTPEvent event) {
        throw new IllegalStateException("You must override this method or IdentityProvider.authenticate");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para HTTP, el método importante a sobreescribir es <code>LambdaIdentityProvider.authenticate(APIGatewayV2HTTPEvent event)</code>. A partir de él asignará una SecurityIdentity en función de cómo desee asignar los datos de seguridad de <code>APIGatewayV2HTTPEvent</code></p>
</div>
<div class="listingblock">
<div class="title">REST <code>quarkus-amazon-lambda-rest</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkus.amazon.lambda.http;

import java.util.Optional;

import com.amazonaws.services.lambda.runtime.events.APIGatewayV2HTTPEvent;

import io.quarkus.amazon.lambda.http.model.AwsProxyRequest;
import io.quarkus.security.identity.AuthenticationRequestContext;
import io.quarkus.security.identity.IdentityProvider;
import io.quarkus.security.identity.SecurityIdentity;
import io.smallrye.mutiny.Uni;

/**
 * Helper interface that removes some boilerplate for creating
 * an IdentityProvider that processes APIGatewayV2HTTPEvent
 */
public interface LambdaIdentityProvider extends IdentityProvider&lt;LambdaAuthenticationRequest&gt; {
...

    /**
     * You must override this method unless you directly override
     * IdentityProvider.authenticate
     *
     * @param event
     * @return
     */
    default SecurityIdentity authenticate(AwsProxyRequest event) {
        throw new IllegalStateException("You must override this method or IdentityProvider.authenticate");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para REST, el método importante a sobreescribir es <code>LambdaIdentityProvider.authenticate(AwsProxyRequest event)</code>. A partir de él, asignará una SecurityIdentity en función de cómo desee asignar los datos de seguridad de <code>AwsProxyRequest</code>.</p>
</div>
<div class="paragraph">
<p>Su proveedor implementado debe ser un bean CDI. He aquí un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme;

import java.security.Principal;

import jakarta.enterprise.context.ApplicationScoped;

import com.amazonaws.services.lambda.runtime.events.APIGatewayV2HTTPEvent;

import io.quarkus.amazon.lambda.http.LambdaIdentityProvider;
import io.quarkus.security.identity.SecurityIdentity;
import io.quarkus.security.runtime.QuarkusPrincipal;
import io.quarkus.security.runtime.QuarkusSecurityIdentity;

@ApplicationScoped
public class CustomSecurityProvider implements LambdaIdentityProvider {
    @Override
    public SecurityIdentity authenticate(APIGatewayV2HTTPEvent event) {
        if (event.getHeaders() == null || !event.getHeaders().containsKey("x-user"))
            return null;
        Principal principal = new QuarkusPrincipal(event.getHeaders().get("x-user"));
        QuarkusSecurityIdentity.Builder builder = QuarkusSecurityIdentity.builder();
        builder.setPrincipal(principal);
        return builder.build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>He aquí el mismo ejemplo, pero con la API REST de AWS Gateway:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme;

import java.security.Principal;

import jakarta.enterprise.context.ApplicationScoped;

import io.quarkus.amazon.lambda.http.model.AwsProxyRequest;

import io.quarkus.amazon.lambda.http.LambdaIdentityProvider;
import io.quarkus.security.identity.SecurityIdentity;
import io.quarkus.security.runtime.QuarkusPrincipal;
import io.quarkus.security.runtime.QuarkusSecurityIdentity;

@ApplicationScoped
public class CustomSecurityProvider implements LambdaIdentityProvider {
    @Override
    public SecurityIdentity authenticate(AwsProxyRequest event) {
        if (event.getMultiValueHeaders() == null || !event.getMultiValueHeaders().containsKey("x-user"))
            return null;
        Principal principal = new QuarkusPrincipal(event.getMultiValueHeaders().getFirst("x-user"));
        QuarkusSecurityIdentity.Builder builder = QuarkusSecurityIdentity.builder();
        builder.setPrincipal(principal);
        return builder.build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Quarkus debería descubrir automáticamente esta implementación y utilizarla en lugar de la implementación por defecto comentada anteriormente.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="simple-sam-local-principal"><a class="anchor" href="#simple-sam-local-principal"></a>Simple SAM Local Principal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Si está probando su aplicación con <code>sam local</code> puede codificar un nombre de entidad de seguridad para utilizarlo cuando se ejecute su aplicación estableciendo la variable de entorno <code>QUARKUS_AWS_LAMBDA_FORCE_USER_NAME</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="snapstart"><a class="anchor" href="#snapstart"></a>SnapStart</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para optimizar su aplicación para Lambda SnapStart, consulte la <a href="amazon-snapstart.html">documentación de configuración de SnapStart</a>.</p>
</div>
</div>
</div>
    </div>
    <div class="grid__item width-4-12 width-12-12-m tocwrapper">
      <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#prerequisites">Requisitos previos</a></li>
<li><a href="#getting-started">Primeros pasos</a></li>
<li><a href="#installing-aws-bits">Instalación de los bits de AWS</a></li>
<li><a href="#creating-the-maven-deployment-project">Creación del proyecto de Maven</a></li>
<li><a href="#build-and-deploy">Construir y desplegar</a></li>
<li><a href="#extra-build-generated-files">Archivos extra generados por la compilación</a></li>
<li><a href="#live-coding-and-simulating-aws-lambda-environment-locally">Codificación en vivo y simulación local del entorno de AWS Lambda</a></li>
<li><a href="#simulate-aws-lambda-deployment-with-sam-cli">Simular la implementación de AWS Lambda con SAM CLI</a></li>
<li><a href="#deploy-to-aws">Implementación en AWS</a></li>
<li><a href="#deploying-a-native-executable">Despliegue de un ejecutable nativo</a></li>
<li><a href="#examine-the-pom">Examinar el POM</a>
<ul class="sectlevel2">
<li><a href="#examine-sam-yaml">Examinar sam.yaml</a></li>
</ul>
</li>
<li><a href="#injectable-aws-context-variables">Variables de contexto de AWS inyectables</a></li>
<li><a href="#tracing-with-aws-xray-and-graalvm">Rastreo con AWS XRay y GraalVM</a></li>
<li><a href="#security-integration">Integración de la seguridad</a></li>
<li><a href="#custom-security-integration">Integración de seguridad personalizada</a></li>
<li><a href="#simple-sam-local-principal">Simple SAM Local Principal</a></li>
<li><a href="#snapstart">SnapStart</a></li>
</ul></div>
    </div>
  </div>
  <h2>Related content</h2>
  <div class="grid-wrapper relations">
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>On the same extensions</h3>
      <ul class="related-content">
      
        
        <li class="guide"><a href="/version/3.20/guides/aws-lambda">AWS Lambda</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/funqy-aws-lambda-http">Funqy HTTP Binding with AWS Lambda</a></li>
      </ul>
    </div>
    <div class="grid__item width-6-12 width-12-12-m">
      <h3>On the same topics</h3>
      <ul class="related-content">
      
        
        <li class="guide"><a href="/version/3.20/guides/aws-lambda">AWS Lambda</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/aws-lambda-snapstart">Configuración de AWS Lambda SnapStart</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/funqy-aws-lambda">Funqy AWS Lambda Binding</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/funqy-aws-lambda-http">Funqy HTTP Binding with AWS Lambda</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/azure-functions">Azure Functions</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/azure-functions-http">Azure Functions with Quarkus REST, Undertow, or Reactive Routes</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/funqy">Funqy</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/funqy-gcp-functions">Funqy Google Cloud Functions</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/funqy-http">Funqy HTTP Binding (Standalone)</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/funqy-azure-functions-http">Enlace HTTP de Funqy con Azure Functions</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/funqy-gcp-functions-http">Enlace HTTP de Funqy con Google Cloud Functions</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/funqy-knative-events">Vinculación de los eventos de Funqy Knative</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/gcp-functions">Google Cloud Functions (Serverless)</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/gcp-functions-http">Google Cloud Functions (Serverless) with Quarkus REST, Undertow, or Reactive Routes</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/appcds">AppCDS</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/container-image">Imágenes de contenedores</a></li>
      
        
        <li class="howto"><a href="/version/3.20/guides/deploying-to-openshift-native-howto">Deploying Quarkus applications compiled to native executables</a></li>
      
        
        <li class="guide"><a href="/version/3.20/guides/deploying-to-openshift">Deploying Quarkus applications to OpenShift</a></li>
      
        
        <li class="howto"><a href="/version/3.20/guides/deploying-to-openshift-howto">Deploying Quarkus applications to OpenShift in a single step</a></li>
      
        
        <li class="howto"><a href="/version/3.20/guides/deploying-to-openshift-docker-howto">Deploying Quarkus Java applications to OpenShift by using a Docker build strategy</a></li>
      </ul>
    </div>
    </div>
  </div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license. <i class='fab fa-creative-commons'></i><i class='fab fa-creative-commons-by'></i> <a href='https://creativecommons.org/licenses/by/3.0/' target='_blank'>CC by 3.0</a><br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>GitHub Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
          
            <li><a href="/" target="_blank">Home</a></li>
          
          
          
            <li><a href="/about" target="_blank">About</a></li>
          
          
          
            <li><a href="/blog" target="_blank">Blog</a></li>
          
          
          
            <li><a href="/insights" target="_blank">Podcast</a></li>
          
          
          
            <li><a href="/events" target="_blank">Events</a></li>
          
          
          
            <li><a href="/newsletter" target="_blank">Boletín de noticias</a></li>
          
          
          
            <li><a href="/userstories" target="_blank">User Stories</a></li>
          
          
          
            <li><a href="https://github.com/orgs/quarkusio/projects/13/views/1" target="_blank">Hoja de ruta</a></li>
          
          
          
            <li><a href="/security" target="_blank">Security&nbsp;policy</a></li>
          
          
          
            <li><a href="/usage" target="_blank">Uso</a></li>
          
          
          
            <li><a href="https://github.com/commonhaus/artwork/tree/main/projects/quarkus" target="_blank">Brand</a></li>
          
          
          
            <li><a href="/desktopwallpapers" target="_blank">Wallpapers</a></li>
          
          
          
            <li><a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy Policy</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Follow Us</span>
        <ul class="footer-links">
          
          
            <li><a href="https://x.com/quarkusio" target="_blank">X</a></li>
          
          
          
            <li><a href="https://bsky.app/profile/quarkus.io" target="_blank">Bluesky</a></li>
          
          
          
            <li><a rel="me" href="https://fosstodon.org/@quarkusio" target="_blank">Mastodon</a></li>
            
          
          
            <li><a href="https://www.threads.com/@quarkusio" target="_blank">Threads</a></li>
          
          
          
            <li><a href="https://www.facebook.com/quarkusio" target="_blank">Facebook</a></li>
          
          
          
            <li><a href="https://www.linkedin.com/company/quarkusio/" target="_blank">Linkedin</a></li>
          
          
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg" target="_blank">Youtube</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio" target="_blank">GitHub</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
          
            <li><a href="/support" target="_blank">Support</a></li>
          
          
          
            <li><a href="/guides" target="_blank">Guías</a></li>
          
          
          
            <li><a href="/faq" target="_blank">FAQ</a></li>
          
          
          
            <li><a href="/get-started" target="_blank">Primeros pasos</a></li>
          
          
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus" target="_blank">Stack Overflow</a></li>
          
          
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions" target="_blank">Discussions</a></li>
          
          
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev" target="_blank">Development mailing list</a></li>
          
          
          
            <li><a href="https://stats.uptimerobot.com/ze1PfweT2p" target="_blank">Quarkus Service Status</a></li>
          
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
          
            <li><a href="https://quarkus.io/" target="_blank">English</a></li>
          
          
          
            <li><a href="https://pt.quarkus.io/" target="_blank">Português&nbsp;(Brasileiro)</a></li>
          
          
          
            <li><a href="https://es.quarkus.io/" target="_blank">Español</a></li>
          
          
          
            <li><a href="https://cn.quarkus.io/" target="_blank">简体中文</a></li>
          
          
          
            <li><a href="https://ja.quarkus.io/" target="_blank">日本語</a></li>
          
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a blah href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a blah href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a blah href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a blah href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a blah href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a blah href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a blah href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a blah href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content cf-footer">
  <div class="flexcontainer">
    <div class="cf-logo">
      <a class="cf-logo" href="https://www.commonhaus.org/" target="_blank"><img src="https://raw.githubusercontent.com/commonhaus/artwork/main/foundation/brand/svg/CF_logo_horizontal_single_reverse.svg"/></a>
    </div>
    <div class="license">
      Copyright © Quarkus. All rights reserved. For details on our trademarks, please visit our <a href="https://www.commonhaus.org/policies/trademark-policy/">Trademark Policy</a> and <a href="https://www.commonhaus.org/trademarks/">Trademark List</a>. Trademarks of third parties are owned by their respective holders and their mention here does not suggest any endorsement or association.
    </div>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
  <script src="/assets/javascript/future-date.js" type="text/javascript"></script>
  <script src="/assets/javascript/randomize.js" type="text/javascript"></script>
  <script src="/assets/javascript/time.js" type="text/javascript"></script>
</body>

</html>
